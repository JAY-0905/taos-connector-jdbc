


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > TSDBDriver</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.taosdata.jdbc</a>
</div>

<h1>Coverage Summary for Class: TSDBDriver (com.taosdata.jdbc)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">TSDBDriver</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (10/10)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    86.1%
  </span>
  <span class="absValue">
    (62/72)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package com.taosdata.jdbc;
&nbsp;
&nbsp;import java.sql.*;
&nbsp;import java.util.Properties;
&nbsp;import java.util.StringTokenizer;
&nbsp;import java.util.logging.Logger;
&nbsp;
&nbsp;/**
&nbsp; * The Java SQL framework allows for multiple database drivers. Each driver
&nbsp; * should supply a class that implements the Driver interface
&nbsp; *
&nbsp; * &lt;p&gt;
&nbsp; * The DriverManager will try to load as many drivers as it can find and then
&nbsp; * for any given connection request, it will ask each driver in turn to try to
&nbsp; * connect to the target URL.
&nbsp; *
&nbsp; * &lt;p&gt;
&nbsp; * It is strongly recommended that each Driver class should be small and stand
&nbsp; * alone so that the Driver class can be loaded and queried without bringing in
&nbsp; * vast quantities of supporting code.
&nbsp; *
&nbsp; * &lt;p&gt;
&nbsp; * When a Driver class is loaded, it should create an instance of itself and
&nbsp; * register it with the DriverManager. This means that a user can load and
&nbsp; * register a driver by doing Class.forName(&quot;foo.bah.Driver&quot;)
&nbsp; */
<b class="fc">&nbsp;public class TSDBDriver extends AbstractDriver {</b>
&nbsp;
&nbsp;    @Deprecated
&nbsp;    private static final String URL_PREFIX1 = &quot;jdbc:TSDB://&quot;;
&nbsp;
&nbsp;    public static final String URL_PREFIX = &quot;jdbc:TAOS://&quot;;
&nbsp;
&nbsp;    /**
&nbsp;     * PRODUCT_NAME
&nbsp;     */
&nbsp;    public static final String PROPERTY_KEY_PRODUCT_NAME = &quot;productName&quot;;
&nbsp;    /**
&nbsp;     * Key used to retrieve the host value from the properties instance passed to
&nbsp;     * the driver.
&nbsp;     */
&nbsp;    public static final String PROPERTY_KEY_HOST = &quot;host&quot;;
&nbsp;    /**
&nbsp;     * Key used to retrieve the port number value from the properties instance
&nbsp;     * passed to the driver.
&nbsp;     */
&nbsp;    public static final String PROPERTY_KEY_PORT = &quot;port&quot;;
&nbsp;    /**
&nbsp;     * Key used to retrieve the database value from the properties instance passed
&nbsp;     * to the driver.
&nbsp;     */
&nbsp;    public static final String PROPERTY_KEY_DBNAME = &quot;dbname&quot;;
&nbsp;    /**
&nbsp;     * Key used to retrieve the user value from the properties instance passed to
&nbsp;     * the driver.
&nbsp;     */
&nbsp;    public static final String PROPERTY_KEY_USER = &quot;user&quot;;
&nbsp;    /**
&nbsp;     * Key used to retrieve the password value from the properties instance passed
&nbsp;     * to the driver.
&nbsp;     */
&nbsp;    public static final String PROPERTY_KEY_PASSWORD = &quot;password&quot;;
&nbsp;    /**
&nbsp;     * Key used to retrieve the token value from the properties instance passed to
&nbsp;     * the driver.
&nbsp;     * Just for Cloud Service
&nbsp;     */
&nbsp;    public static final String PROPERTY_KEY_TOKEN = &quot;token&quot;;
&nbsp;    /**
&nbsp;     * Use SSL (true/false) to communicate with the server. The default value is false.
&nbsp;     * Just for Cloud Service
&nbsp;     */
&nbsp;    public static final String PROPERTY_KEY_USE_SSL = &quot;useSSL&quot;;
&nbsp;    /**
&nbsp;     * Key for the configuration file directory of TSDB client in properties instance
&nbsp;     */
&nbsp;    public static final String PROPERTY_KEY_CONFIG_DIR = &quot;cfgdir&quot;;
&nbsp;    /**
&nbsp;     * Key for the timezone used by the TSDB client in properties instance
&nbsp;     */
&nbsp;    public static final String PROPERTY_KEY_TIME_ZONE = &quot;timezone&quot;;
&nbsp;    /**
&nbsp;     * Key for the locale used by the TSDB client in properties instance
&nbsp;     */
&nbsp;    public static final String PROPERTY_KEY_LOCALE = &quot;locale&quot;;
&nbsp;    /**
&nbsp;     * Key for the char encoding used by the TSDB client in properties instance
&nbsp;     */
&nbsp;    public static final String PROPERTY_KEY_CHARSET = &quot;charset&quot;;
&nbsp;
&nbsp;    /**
&nbsp;     * fetch data from native function in a batch model
&nbsp;     */
&nbsp;    public static final String PROPERTY_KEY_BATCH_LOAD = &quot;batchfetch&quot;;
&nbsp;
&nbsp;    /**
&nbsp;     * continue process commands in executeBatch
&nbsp;     */
&nbsp;    public static final String PROPERTY_KEY_BATCH_ERROR_IGNORE = &quot;batchErrorIgnore&quot;;
&nbsp;
&nbsp;    /**
&nbsp;     * message receive from server timeout. ms
&nbsp;     */
&nbsp;    public static final String PROPERTY_KEY_MESSAGE_WAIT_TIMEOUT = &quot;messageWaitTimeout&quot;;
&nbsp;
&nbsp;    /**
&nbsp;     * connect mode
&nbsp;     */
&nbsp;    public static final String PROPERTY_KEY_CONNECT_MODE = &quot;conmode&quot;;
&nbsp;
&nbsp;    /**
&nbsp;     * max message number send to server concurrently
&nbsp;     */
&nbsp;    public static final String PROPERTY_KEY_MAX_CONCURRENT_REQUEST = &quot;maxConcurrentRequest&quot;;
&nbsp;
&nbsp;    /**
&nbsp;     * max pool size
&nbsp;     */
&nbsp;    public static final String HTTP_POOL_SIZE = &quot;httpPoolSize&quot;;
&nbsp;
&nbsp;    public static final String HTTP_KEEP_ALIVE = &quot;httpKeepAlive&quot;;
&nbsp;
&nbsp;    /**
&nbsp;     * the timeout in milliseconds until a connection is established.
&nbsp;     * zero is interpreted as an infinite timeout.
&nbsp;     */
&nbsp;    public static final String HTTP_CONNECT_TIMEOUT = &quot;httpConnectTimeout&quot;;
&nbsp;
&nbsp;    /**
&nbsp;     * Defines the socket timeout in milliseconds,
&nbsp;     * which is the timeout for waiting for data or, put differently,
&nbsp;     * a maximum period inactivity between two consecutive data packets.
&nbsp;     * zero is interpreted as an infinite timeout.
&nbsp;     */
&nbsp;    public static final String HTTP_SOCKET_TIMEOUT = &quot;httpSocketTimeout&quot;;
&nbsp;
&nbsp;    public static final String HTTP_TIME_ZONE= &quot;tz&quot;;
&nbsp;
<b class="fc">&nbsp;    private TSDBDatabaseMetaData dbMetaData = null;</b>
&nbsp;
&nbsp;    static {
&nbsp;        try {
<b class="fc">&nbsp;            DriverManager.registerDriver(new TSDBDriver());</b>
<b class="nc">&nbsp;        } catch (SQLException e) {</b>
<b class="nc">&nbsp;            throw TSDBError.createRuntimeException(TSDBErrorNumbers.ERROR_CANNOT_REGISTER_JNI_DRIVER, e);</b>
<b class="fc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    public Connection connect(String url, Properties info) throws SQLException {
<b class="fc">&nbsp;        if (!acceptsURL(url))</b>
<b class="fc">&nbsp;            return null;</b>
&nbsp;
<b class="fc">&nbsp;        Properties props = parseURL(url, info);</b>
<b class="fc">&nbsp;        if (props == null) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (!props.containsKey(TSDBDriver.PROPERTY_KEY_USER))</b>
<b class="fc">&nbsp;            throw TSDBError.createSQLException(TSDBErrorNumbers.ERROR_USER_IS_REQUIRED);</b>
<b class="fc">&nbsp;        if (!props.containsKey(TSDBDriver.PROPERTY_KEY_PASSWORD))</b>
<b class="fc">&nbsp;            throw TSDBError.createSQLException(TSDBErrorNumbers.ERROR_PASSWORD_IS_REQUIRED);</b>
&nbsp;
&nbsp;        try {
<b class="fc">&nbsp;            TSDBJNIConnector.init(props);</b>
<b class="fc">&nbsp;            return new TSDBConnection(props, this.dbMetaData);</b>
<b class="nc">&nbsp;        } catch (SQLWarning sqlWarning) {</b>
<b class="nc">&nbsp;            return new TSDBConnection(props, this.dbMetaData);</b>
<b class="fc">&nbsp;        } catch (SQLException sqlEx) {</b>
<b class="fc">&nbsp;            throw sqlEx;</b>
<b class="nc">&nbsp;        } catch (Exception ex) {</b>
<b class="nc">&nbsp;            throw new SQLException(&quot;SQLException:&quot; + ex, ex);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @param url the URL of the database
&nbsp;     * @return &lt;code&gt;true&lt;/code&gt; if this driver understands the given URL;
&nbsp;     * &lt;code&gt;false&lt;/code&gt; otherwise
&nbsp;     * @throws SQLException if a database access error occurs or the url is {@code null}
&nbsp;     */
&nbsp;    public boolean acceptsURL(String url) throws SQLException {
<b class="fc">&nbsp;        if (url == null)</b>
<b class="fc">&nbsp;            throw TSDBError.createSQLException(TSDBErrorNumbers.ERROR_URL_NOT_SET);</b>
<b class="fc">&nbsp;        return url.trim().length() &gt; 0 &amp;&amp; (url.startsWith(URL_PREFIX) || url.startsWith(URL_PREFIX1));</b>
&nbsp;    }
&nbsp;
&nbsp;    public DriverPropertyInfo[] getPropertyInfo(String url, Properties info) throws SQLException {
<b class="fc">&nbsp;        if (info == null) {</b>
<b class="nc">&nbsp;            info = new Properties();</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (acceptsURL(url)) {</b>
<b class="fc">&nbsp;            info = parseURL(url, info);</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        return getPropertyInfo(info);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * example: jdbc:TAOS://127.0.0.1:0/db?user=root&amp;password=your_password
&nbsp;     */
&nbsp;    @Override
&nbsp;    public Properties parseURL(String url, Properties defaults) {
<b class="fc">&nbsp;        Properties urlProps = (defaults != null) ? defaults : new Properties();</b>
<b class="fc">&nbsp;        if (url == null || url.length() &lt;= 0 || url.trim().length() &lt;= 0)</b>
<b class="nc">&nbsp;            return null;</b>
<b class="fc">&nbsp;        if (!url.startsWith(URL_PREFIX) &amp;&amp; !url.startsWith(URL_PREFIX1))</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;
&nbsp;        // parse properties
<b class="fc">&nbsp;        String urlForMeta = url;</b>
<b class="fc">&nbsp;        int beginningOfSlashes = url.indexOf(&quot;//&quot;);</b>
<b class="fc">&nbsp;        int index = url.indexOf(&quot;?&quot;);</b>
<b class="fc">&nbsp;        if (index != -1) {</b>
<b class="fc">&nbsp;            String paramString = url.substring(index + 1);</b>
<b class="fc">&nbsp;            url = url.substring(0, index);</b>
<b class="fc">&nbsp;            StringTokenizer queryParams = new StringTokenizer(paramString, &quot;&amp;&quot;);</b>
<b class="fc">&nbsp;            while (queryParams.hasMoreElements()) {</b>
<b class="fc">&nbsp;                String oneToken = queryParams.nextToken();</b>
<b class="fc">&nbsp;                String[] pair = oneToken.split(&quot;=&quot;);</b>
&nbsp;
<b class="fc">&nbsp;                if ((pair[0] != null &amp;&amp; pair[0].trim().length() &gt; 0) &amp;&amp; (pair[1] != null &amp;&amp; pair[1].trim().length() &gt; 0)) {</b>
<b class="fc">&nbsp;                    urlProps.setProperty(pair[0].trim(), pair[1].trim());</b>
&nbsp;                }
<b class="fc">&nbsp;            }</b>
&nbsp;        }
&nbsp;
&nbsp;        // parse Product Name
<b class="fc">&nbsp;        String dbProductName = url.substring(0, beginningOfSlashes);</b>
<b class="fc">&nbsp;        dbProductName = dbProductName.substring(dbProductName.indexOf(&quot;:&quot;) + 1);</b>
<b class="fc">&nbsp;        dbProductName = dbProductName.substring(0, dbProductName.indexOf(&quot;:&quot;));</b>
<b class="fc">&nbsp;        urlProps.setProperty(TSDBDriver.PROPERTY_KEY_PRODUCT_NAME, dbProductName);</b>
&nbsp;
&nbsp;        // parse database name
<b class="fc">&nbsp;        url = url.substring(beginningOfSlashes + 2);</b>
<b class="fc">&nbsp;        int indexOfSlash = url.indexOf(&quot;/&quot;);</b>
<b class="fc">&nbsp;        if (indexOfSlash != -1) {</b>
<b class="fc">&nbsp;            if (indexOfSlash + 1 &lt; url.length()) {</b>
<b class="fc">&nbsp;                urlProps.setProperty(TSDBDriver.PROPERTY_KEY_DBNAME, url.substring(indexOfSlash + 1).toLowerCase());</b>
&nbsp;            }
<b class="fc">&nbsp;            url = url.substring(0, indexOfSlash);</b>
&nbsp;        }
&nbsp;
&nbsp;        // parse port
<b class="fc">&nbsp;        int indexOfColon = url.indexOf(&quot;:&quot;);</b>
<b class="fc">&nbsp;        if (indexOfColon != -1) {</b>
<b class="fc">&nbsp;            if (indexOfColon + 1 &lt; url.length()) {</b>
<b class="fc">&nbsp;                urlProps.setProperty(TSDBDriver.PROPERTY_KEY_PORT, url.substring(indexOfColon + 1));</b>
&nbsp;            }
<b class="fc">&nbsp;            url = url.substring(0, indexOfColon);</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (url.length() &gt; 0 &amp;&amp; url.trim().length() &gt; 0) {</b>
<b class="fc">&nbsp;            urlProps.setProperty(TSDBDriver.PROPERTY_KEY_HOST, url);</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        this.dbMetaData = new TSDBDatabaseMetaData(urlForMeta, urlProps.getProperty(TSDBDriver.PROPERTY_KEY_USER));</b>
<b class="fc">&nbsp;        return urlProps;</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getMajorVersion() {
<b class="fc">&nbsp;        return 3;</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getMinorVersion() {
<b class="fc">&nbsp;        return 0;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean jdbcCompliant() {
<b class="fc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    public Logger getParentLogger() {
<b class="fc">&nbsp;        return null;</b>
&nbsp;    }
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-10-08 10:56</div>
</div>
</body>
</html>
