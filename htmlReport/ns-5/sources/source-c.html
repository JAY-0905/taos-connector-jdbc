


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > TMQConnector</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.taosdata.jdbc.tmq</a>
</div>

<h1>Coverage Summary for Class: TMQConnector (com.taosdata.jdbc.tmq)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">TMQConnector</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    89.3%
  </span>
  <span class="absValue">
    (25/28)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    57.6%
  </span>
  <span class="absValue">
    (83/144)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package com.taosdata.jdbc.tmq;
&nbsp;
&nbsp;import com.taosdata.jdbc.*;
&nbsp;import com.taosdata.jdbc.utils.StringUtils;
&nbsp;
&nbsp;import java.sql.SQLException;
&nbsp;import java.util.*;
&nbsp;import java.util.stream.Collectors;
&nbsp;
&nbsp;import static com.taosdata.jdbc.TSDBConstants.*;
&nbsp;import static com.taosdata.jdbc.TSDBErrorNumbers.ERROR_JNI_RESULT_SET_NULL;
&nbsp;import static com.taosdata.jdbc.TSDBErrorNumbers.ERROR_TMQ_CONSUMER_NULL;
&nbsp;
<b class="fc">&nbsp;public class TMQConnector extends TSDBJNIConnector {</b>
&nbsp;
&nbsp;    private String createConsumerErrorMsg;
&nbsp;    private String[] topics;
&nbsp;
&nbsp;    public long createConfig(Properties properties) throws SQLException {
<b class="fc">&nbsp;        long conf = tmqConfNewImp();</b>
<b class="fc">&nbsp;        if (null == properties || properties.size() &lt; 1)</b>
<b class="nc">&nbsp;            return conf;</b>
<b class="fc">&nbsp;        for (Map.Entry&lt;?, ?&gt; entry : properties.entrySet()) {</b>
<b class="fc">&nbsp;            String key = String.valueOf(entry.getKey());</b>
<b class="fc">&nbsp;            if (!StringUtils.isEmpty(key) &amp;&amp; TMQConstants.configSet.contains(key)) {</b>
<b class="fc">&nbsp;                int code = tmqConfSetImp(conf, key, String.valueOf(entry.getValue()));</b>
<b class="fc">&nbsp;                if (code == TMQ_CONF_KEY_NULL) {</b>
<b class="nc">&nbsp;                    tmqConfDestroyImp(conf);</b>
<b class="nc">&nbsp;                    throw TSDBError.createSQLException(TSDBErrorNumbers.ERROR_TMQ_CONF_KEY_NULL);</b>
&nbsp;                }
<b class="fc">&nbsp;                if (code == TMQ_CONF_VALUE_NULL) {</b>
<b class="nc">&nbsp;                    tmqConfDestroyImp(conf);</b>
<b class="nc">&nbsp;                    throw TSDBError.createSQLException(TSDBErrorNumbers.ERROR_TMQ_CONF_VALUE_NULL, &quot;failed to set consumer property, &quot; + key + &quot;&#39;s value is null&quot;);</b>
&nbsp;                }
<b class="fc">&nbsp;                if (code &lt; TMQ_SUCCESS) {</b>
<b class="nc">&nbsp;                    tmqConfDestroyImp(conf);</b>
<b class="nc">&nbsp;                    throw TSDBError.createSQLException(code,</b>
<b class="nc">&nbsp;                            &quot;failed to set consumer property, &quot; + key + &quot;:&quot; + entry.getValue() + &quot;, reason: &quot; + getErrMsg(code));</b>
&nbsp;                }
&nbsp;            }
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;        return conf;</b>
&nbsp;    }
&nbsp;
&nbsp;    // DLL_EXPORT tmq_conf_t *tmq_conf_new();
&nbsp;    private native long tmqConfNewImp();
&nbsp;
&nbsp;    // DLL_EXPORT tmq_conf_res_t tmq_conf_set(tmq_conf_t *conf,
&nbsp;    // const char *key, const char *value);
&nbsp;    private native int tmqConfSetImp(long conf, String key, String value);
&nbsp;
&nbsp;    public void destroyConf(long conf) {
<b class="fc">&nbsp;        tmqConfDestroyImp(conf);</b>
&nbsp;    }
&nbsp;
&nbsp;    // DLL_EXPORT void tmq_conf_destroy(tmq_conf_t *conf);
&nbsp;    private native void tmqConfDestroyImp(long conf);
&nbsp;
&nbsp;    public void createConsumer(long conf) throws SQLException {
<b class="fc">&nbsp;        taos = tmqConsumerNewImp(conf, this);</b>
<b class="fc">&nbsp;        if (taos == TMQ_CONF_NULL) {</b>
<b class="nc">&nbsp;            throw TSDBError.createSQLException(TMQ_CONF_NULL);</b>
&nbsp;        }
<b class="fc">&nbsp;        if (taos == JNI_OUT_OF_MEMORY) {</b>
<b class="nc">&nbsp;            throw TSDBError.createSQLException(TSDBErrorNumbers.ERROR_JNI_OUT_OF_MEMORY);</b>
&nbsp;        }
<b class="fc">&nbsp;        if (taos &lt; TMQ_SUCCESS) {</b>
<b class="nc">&nbsp;            throw TSDBError.createSQLException(TSDBErrorNumbers.ERROR_TMQ_CONSUMER_CREATE_ERROR, createConsumerErrorMsg);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    // DLL_EXPORT tmq_t *tmq_consumer_new(tmq_conf_t *conf,
&nbsp;    // char *errstr, int32_t errstrLen);
&nbsp;    private native long tmqConsumerNewImp(long conf, TMQConnector connector);
&nbsp;
&nbsp;    void setCreateConsumerErrorMsg(String msg) {
<b class="nc">&nbsp;        this.createConsumerErrorMsg = msg;</b>
&nbsp;    }
&nbsp;
&nbsp;    public long createTopic(Collection&lt;String&gt; topics) throws SQLException {
<b class="fc">&nbsp;        long topic = tmqTopicNewImp(taos);</b>
<b class="fc">&nbsp;        if (topic &lt; TMQ_SUCCESS) {</b>
<b class="nc">&nbsp;            throw TSDBError.createSQLException(ERROR_TMQ_CONSUMER_NULL);</b>
&nbsp;        }
<b class="fc">&nbsp;        if (null != topics &amp;&amp; !topics.isEmpty()) {</b>
<b class="fc">&nbsp;            for (String name : topics) {</b>
<b class="fc">&nbsp;                int code = tmqTopicAppendImp(topic, name);</b>
<b class="fc">&nbsp;                if (code == TMQ_TOPIC_NULL) {</b>
<b class="nc">&nbsp;                    destroyTopic(topic);</b>
<b class="nc">&nbsp;                    throw TSDBError.createSQLException(TSDBErrorNumbers.ERROR_TMQ_TOPIC_NULL);</b>
&nbsp;                }
<b class="fc">&nbsp;                if (code == TMQ_TOPIC_NAME_NULL) {</b>
<b class="nc">&nbsp;                    destroyTopic(topic);</b>
<b class="nc">&nbsp;                    throw TSDBError.createSQLException(TSDBErrorNumbers.ERROR_TMQ_TOPIC_NAME_NULL);</b>
&nbsp;                }
<b class="fc">&nbsp;                if (code != TMQ_SUCCESS) {</b>
<b class="nc">&nbsp;                    destroyTopic(topic);</b>
<b class="nc">&nbsp;                    throw TSDBError.createSQLException(code, getErrMsg(code));</b>
&nbsp;                }
<b class="fc">&nbsp;            }</b>
&nbsp;        }
<b class="fc">&nbsp;        return topic;</b>
&nbsp;    }
&nbsp;
&nbsp;    // DLL_EXPORT tmq_list_t *tmq_list_new();
&nbsp;    private native long tmqTopicNewImp(long tmq);
&nbsp;
&nbsp;    // DLL_EXPORT int32_t tmq_list_append(tmq_list_t *, const char *);
&nbsp;    private native int tmqTopicAppendImp(long topic, String topicName);
&nbsp;
&nbsp;    public void destroyTopic(long topic) {
<b class="fc">&nbsp;        tmqTopicDestroyImp(topic);</b>
&nbsp;    }
&nbsp;
&nbsp;    // DLL_EXPORT void tmq_list_destroy(tmq_list_t *);
&nbsp;    private native void tmqTopicDestroyImp(long topic);
&nbsp;
&nbsp;    public void subscribe(long topic) throws SQLException {
<b class="fc">&nbsp;        int code = tmqSubscribeImp(taos, topic);</b>
<b class="fc">&nbsp;        if (code == TMQ_CONSUMER_NULL)</b>
<b class="nc">&nbsp;            throw TSDBError.createSQLException(ERROR_TMQ_CONSUMER_NULL, &quot;failed to subscribe topic, consumer reference has been destroyed&quot;);</b>
&nbsp;
<b class="fc">&nbsp;        if (code == TMQ_TOPIC_NULL)</b>
<b class="nc">&nbsp;            throw TSDBError.createSQLException(TSDBErrorNumbers.ERROR_TMQ_TOPIC_NULL);</b>
&nbsp;
<b class="fc">&nbsp;        if (code != TMQ_SUCCESS)</b>
<b class="nc">&nbsp;            throw TSDBError.createSQLException(code, getErrMsg(code));</b>
&nbsp;    }
&nbsp;
&nbsp;    // DLL_EXPORT int32_t tmq_subscribe(tmq_t *tmq, const tmq_list_t *topic_list);
&nbsp;    private native int tmqSubscribeImp(long tmq, long topic);
&nbsp;
&nbsp;    public Set&lt;String&gt; subscription() throws SQLException {
<b class="fc">&nbsp;        int code = tmqSubscriptionImp(taos, this);</b>
<b class="fc">&nbsp;        if (code == TMQ_CONSUMER_NULL)</b>
<b class="nc">&nbsp;            throw TSDBError.createSQLException(ERROR_TMQ_CONSUMER_NULL, &quot;get subscription error, consumer reference has been destroyed&quot;);</b>
&nbsp;
<b class="fc">&nbsp;        if (code != TMQ_SUCCESS)</b>
<b class="nc">&nbsp;            throw TSDBError.createSQLException(code, getErrMsg(code));</b>
&nbsp;
<b class="fc">&nbsp;        return Arrays.stream(topics).collect(Collectors.toSet());</b>
&nbsp;    }
&nbsp;
&nbsp;    // DLL_EXPORT int32_t tmq_subscription(tmq_t *tmq, tmq_list_t **topics);
&nbsp;    private native int tmqSubscriptionImp(long tmq, TMQConnector connector);
&nbsp;
&nbsp;    public void setTopicList(String[] topics) {
<b class="fc">&nbsp;        this.topics = topics;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void syncCommit() throws SQLException {
<b class="fc">&nbsp;        int code = tmqCommitAllSync(taos);</b>
<b class="fc">&nbsp;        if (code == TMQ_CONSUMER_NULL)</b>
<b class="nc">&nbsp;            throw TSDBError.createSQLException(ERROR_TMQ_CONSUMER_NULL, &quot;sync commit offset error, consumer reference has been destroyed&quot;);</b>
&nbsp;
<b class="fc">&nbsp;        if (code != TMQ_SUCCESS)</b>
<b class="nc">&nbsp;            throw TSDBError.createSQLException(code, createConsumerErrorMsg);</b>
&nbsp;    }
&nbsp;
&nbsp;    // commit all
&nbsp;    private native int tmqCommitAllSync(long tmq);
&nbsp;
&nbsp;    public void commitOffsetSync(String topicName, int vgId, long offset) throws SQLException {
<b class="fc">&nbsp;        int code = tmqCommitOffsetSyncImp(this.taos, topicName, vgId, offset);</b>
<b class="fc">&nbsp;        if (code != TMQ_SUCCESS) {</b>
<b class="nc">&nbsp;            if (code == TMQ_CONSUMER_NULL) {</b>
<b class="nc">&nbsp;                throw TSDBError.createSQLException(ERROR_TMQ_CONSUMER_NULL);</b>
<b class="nc">&nbsp;            } else if (code == TMQ_TOPIC_NULL) {</b>
<b class="nc">&nbsp;                throw TSDBError.createSQLException(TSDBErrorNumbers.ERROR_TMQ_TOPIC_NULL);</b>
&nbsp;            }
<b class="nc">&nbsp;            throw TSDBError.createSQLException(code, getErrMsg(code));</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    // DLL_EXPORT int32_t   tmq_commit_offset_sync(tmq_t *tmq, const char *pTopicName, int32_t vgId, int64_t offset);
&nbsp;    private native int tmqCommitOffsetSyncImp(long tmq, String topicName, int vgId, long offset);
&nbsp;
&nbsp;    public void asyncCommit(OffsetWaitCallback&lt;?&gt; callback) {
<b class="fc">&nbsp;        consumerCommitAllAsync(taos, callback);</b>
&nbsp;    }
&nbsp;
&nbsp;    private native void consumerCommitAllAsync(long tmq, OffsetWaitCallback&lt;?&gt; callback);
&nbsp;
&nbsp;    public void asyncCommit(String topicName, int vgId, long offset, OffsetWaitCallback&lt;?&gt; callback) {
<b class="nc">&nbsp;        if (taos == 0) {</b>
<b class="nc">&nbsp;            throw TSDBError.createIllegalArgumentException(ERROR_TMQ_CONSUMER_NULL);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (topicName == null || topicName.isEmpty()) {</b>
<b class="nc">&nbsp;            throw TSDBError.createIllegalArgumentException(TSDBErrorNumbers.ERROR_TMQ_TOPIC_NULL);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        consumerCommitOffsetAsync(taos, topicName, vgId, offset, callback);</b>
&nbsp;    }
&nbsp;
&nbsp;    // DLL_EXPORT void      tmq_commit_offset_async(tmq_t *tmq, const char *pTopicName, int32_t vgId, int64_t offset, tmq_commit_cb *cb, void *param);
&nbsp;    private native void consumerCommitOffsetAsync(long tmq, String topicName, int vgId, long offset, OffsetWaitCallback&lt;?&gt; callback);
&nbsp;
&nbsp;    public void unsubscribe() throws SQLException {
<b class="fc">&nbsp;        int code = tmqUnsubscribeImp(taos);</b>
<b class="fc">&nbsp;        if (code == TMQ_CONSUMER_NULL)</b>
<b class="nc">&nbsp;            throw TSDBError.createSQLException(ERROR_TMQ_CONSUMER_NULL, &quot;unsubscribe error, consumer reference has been destroyed&quot;);</b>
&nbsp;
<b class="fc">&nbsp;        if (code != TMQ_SUCCESS)</b>
<b class="nc">&nbsp;            throw TSDBError.createSQLException(code, getErrMsg(code));</b>
&nbsp;    }
&nbsp;
&nbsp;    // DLL_EXPORT int32_t tmq_unsubscribe(tmq_t *tmq);
&nbsp;    private native int tmqUnsubscribeImp(long tmq);
&nbsp;
&nbsp;    public void closeConsumer() throws SQLException {
<b class="fc">&nbsp;        int code = tmqConsumerCloseImp(taos);</b>
<b class="fc">&nbsp;        if (code != TMQ_SUCCESS &amp;&amp; code != TMQ_CONSUMER_NULL)</b>
<b class="nc">&nbsp;            throw TSDBError.createSQLException(code, getErrMsgImp(code));</b>
&nbsp;    }
&nbsp;
&nbsp;    // DLL_EXPORT int32_t tmq_consumer_close(tmq_t *tmq);
&nbsp;    private native int tmqConsumerCloseImp(long tmq);
&nbsp;
&nbsp;
&nbsp;    // TODO confirm code range, which is applied to
&nbsp;    public String getErrMsg(int code) {
<b class="nc">&nbsp;        return this.getErrMsgImp(code);</b>
&nbsp;    }
&nbsp;
&nbsp;    // DLL_EXPORT const char *tmq_err2str(int32_t code);
&nbsp;    private native String getErrMsgImp(int code);
&nbsp;
&nbsp;    public long poll(long waitTime) throws SQLException {
<b class="fc">&nbsp;        long l = tmqConsumerPoll(taos, waitTime);</b>
<b class="fc">&nbsp;        if (l == TMQ_CONSUMER_NULL)</b>
<b class="nc">&nbsp;            throw TSDBError.createSQLException(ERROR_TMQ_CONSUMER_NULL);</b>
&nbsp;
<b class="fc">&nbsp;        return l;</b>
&nbsp;    }
&nbsp;
&nbsp;    // DLL_EXPORT TAOS_RES *tmq_consumer_poll(tmq_t *tmq, int64_t wait_time);
&nbsp;    private native long tmqConsumerPoll(long tmq, long waitTime);
&nbsp;
&nbsp;
&nbsp;    public String getTopicName(long res) throws SQLException {
<b class="fc">&nbsp;        String s = tmqGetTopicName(res);</b>
<b class="fc">&nbsp;        if (s == null)</b>
<b class="nc">&nbsp;            throw TSDBError.createSQLException(ERROR_TMQ_CONSUMER_NULL);</b>
&nbsp;
<b class="fc">&nbsp;        return s;</b>
&nbsp;    }
&nbsp;
&nbsp;    // DLL_EXPORT const char *tmq_get_topic_name(TAOS_RES *res);
&nbsp;    private native String tmqGetTopicName(long res);
&nbsp;
&nbsp;    public String getDbName(long res) throws SQLException {
<b class="fc">&nbsp;        String s = tmqGetDbName(res);</b>
<b class="fc">&nbsp;        if (s == null)</b>
<b class="nc">&nbsp;            throw TSDBError.createSQLException(ERROR_TMQ_CONSUMER_NULL);</b>
&nbsp;
<b class="fc">&nbsp;        return s;</b>
&nbsp;    }
&nbsp;
&nbsp;    // DLL_EXPORT const char *tmq_get_db_name(TAOS_RES *res);
&nbsp;    private native String tmqGetDbName(long res);
&nbsp;
&nbsp;    public int getVgroupId(long res) throws SQLException {
<b class="fc">&nbsp;        int code = tmqGetVgroupId(res);</b>
<b class="fc">&nbsp;        if (code == JNI_RESULT_SET_NULL)</b>
<b class="nc">&nbsp;            throw TSDBError.createSQLException(ERROR_JNI_RESULT_SET_NULL);</b>
&nbsp;
<b class="fc">&nbsp;        return code;</b>
&nbsp;    }
&nbsp;
&nbsp;    // DLL_EXPORT int32_t tmq_get_vgroup_id(TAOS_RES *res);
&nbsp;    private native int tmqGetVgroupId(long res);
&nbsp;
&nbsp;    public String getTableName(long res) {
<b class="fc">&nbsp;        return tmqGetTableName(res);</b>
&nbsp;    }
&nbsp;
&nbsp;    // DLL_EXPORT const char *tmq_get_table_name(TAOS_RES *res);
&nbsp;    private native String tmqGetTableName(long res);
&nbsp;
&nbsp;    // DLL_EXPORT int64_t     tmq_get_vgroup_offset(TAOS_RES* res);
&nbsp;    private native long tmqGetOffset(long res);
&nbsp;
&nbsp;    public long getOffset(long res) throws SQLException {
<b class="fc">&nbsp;        long l = tmqGetOffset(res);</b>
<b class="fc">&nbsp;        if (l == JNI_RESULT_SET_NULL)</b>
<b class="nc">&nbsp;            throw TSDBError.createSQLException(ERROR_JNI_RESULT_SET_NULL);</b>
&nbsp;
<b class="fc">&nbsp;        return l;</b>
&nbsp;    }
&nbsp;
&nbsp;    public int fetchBlock(long resultSet, TSDBResultSetBlockData blockData, List&lt;ColumnMetaData&gt; columnMetaData) {
<b class="fc">&nbsp;        int ret = this.fetchRawBlockImp(this.taos, resultSet, blockData, columnMetaData);</b>
<b class="fc">&nbsp;        columnMetaData.forEach(column -&gt; column.setColIndex(column.getColIndex() + 1));</b>
<b class="fc">&nbsp;        return ret;</b>
&nbsp;    }
&nbsp;
&nbsp;    private native int fetchRawBlockImp(long connection, long resultSet, TSDBResultSetBlockData blockData, List&lt;ColumnMetaData&gt; columnMetaData);
&nbsp;
&nbsp;    public void seek(String topicName, int vgId, long offset) {
<b class="fc">&nbsp;        int code = tmqSeekImp(this.taos, topicName, vgId, offset);</b>
<b class="fc">&nbsp;        if (code != TMQ_SUCCESS) {</b>
<b class="nc">&nbsp;            if (code == TMQ_CONSUMER_NULL) {</b>
<b class="nc">&nbsp;                throw TSDBError.createRuntimeException(ERROR_TMQ_CONSUMER_NULL);</b>
<b class="nc">&nbsp;            } else if (code == TMQ_TOPIC_NULL) {</b>
<b class="nc">&nbsp;                throw TSDBError.createRuntimeException(TSDBErrorNumbers.ERROR_TMQ_TOPIC_NULL);</b>
&nbsp;            }
<b class="nc">&nbsp;            throw TSDBError.createRuntimeException(code, getErrMsg(code));</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    // DLL_EXPORT int32_t   tmq_offset_seek(tmq_t *tmq, const char* pTopicName, int32_t vgId, int64_t offset);
&nbsp;    private native int tmqSeekImp(long tmq, String topicName, int vgId, long offset);
&nbsp;
&nbsp;    public List&lt;Assignment&gt; getTopicAssignment(String topicName) {
<b class="fc">&nbsp;        List&lt;Assignment&gt; assignments = new ArrayList&lt;&gt;();</b>
<b class="fc">&nbsp;        int code = tmqGetTopicAssignmentImp(this.taos, topicName, assignments);</b>
<b class="fc">&nbsp;        if (code != TMQ_SUCCESS) {</b>
<b class="nc">&nbsp;            if (code == TMQ_CONSUMER_NULL) {</b>
<b class="nc">&nbsp;                throw TSDBError.createRuntimeException(ERROR_TMQ_CONSUMER_NULL);</b>
<b class="nc">&nbsp;            } else if (code == TMQ_TOPIC_NULL) {</b>
<b class="nc">&nbsp;                throw TSDBError.createRuntimeException(TSDBErrorNumbers.ERROR_TMQ_TOPIC_NULL);</b>
&nbsp;            }
<b class="nc">&nbsp;            throw TSDBError.createRuntimeException(code, getErrMsg(code));</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        return assignments;</b>
&nbsp;    }
&nbsp;
&nbsp;    // DLL_EXPORT int32_t   tmq_get_topic_assignment(tmq_t *tmq, const char* pTopicName, tmq_topic_assignment **assignment, int32_t *numOfAssignment);
&nbsp;    private native int tmqGetTopicAssignmentImp(long tmq, String topicName, List&lt;Assignment&gt; assignments);
&nbsp;
&nbsp;    public long committed(String topicName, int vgId) throws SQLException {
<b class="fc">&nbsp;        long l = tmqCommittedImp(this.taos, topicName, vgId);</b>
<b class="fc">&nbsp;        if (l == TMQ_CONSUMER_NULL) {</b>
<b class="nc">&nbsp;            throw TSDBError.createSQLException(ERROR_TMQ_CONSUMER_NULL);</b>
<b class="fc">&nbsp;        } else if (l == TMQ_TOPIC_NULL) {</b>
<b class="nc">&nbsp;            throw TSDBError.createSQLException(TSDBErrorNumbers.ERROR_TMQ_TOPIC_NULL);</b>
&nbsp;        }
<b class="fc">&nbsp;        if (l &lt; TMQ_SUCCESS &amp;&amp; l != TMQConstants.INVALID_OFFSET)</b>
<b class="nc">&nbsp;            throw TSDBError.createSQLException((int) l, getErrMsg((int) l));</b>
&nbsp;
<b class="fc">&nbsp;        return l;</b>
&nbsp;    }
&nbsp;
&nbsp;    // DLL_EXPORT int64_t     tmq_committed(tmq_t *tmq, const char *pTopicName, int32_t vgId)
&nbsp;    private native long tmqCommittedImp(long tmq, String topicName, int vgId);
&nbsp;
&nbsp;    public long position(String topicName, int vgId) throws SQLException {
<b class="fc">&nbsp;        long l = tmqPositionImp(this.taos, topicName, vgId);</b>
<b class="fc">&nbsp;        if (l == TMQ_CONSUMER_NULL) {</b>
<b class="nc">&nbsp;            throw TSDBError.createSQLException(ERROR_TMQ_CONSUMER_NULL);</b>
<b class="fc">&nbsp;        } else if (l == TMQ_TOPIC_NULL) {</b>
<b class="nc">&nbsp;            throw TSDBError.createSQLException(TSDBErrorNumbers.ERROR_TMQ_TOPIC_NULL);</b>
&nbsp;        }
<b class="fc">&nbsp;        if (l &lt; TMQ_SUCCESS)</b>
<b class="nc">&nbsp;            throw TSDBError.createSQLException((int) l, getErrMsg((int) l));</b>
&nbsp;
<b class="fc">&nbsp;        return l;</b>
&nbsp;    }
&nbsp;
&nbsp;    // DLL_EXPORT int64_t     tmq_position(tmq_t *tmq, const char *pTopicName, int32_t vgId)
&nbsp;    private native long tmqPositionImp(long tmq, String topicName, int vgId);
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-10-08 10:56</div>
</div>
</body>
</html>
